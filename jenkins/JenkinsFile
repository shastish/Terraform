pipeline{
        agent any
    parameters {

                string(name: 'git_branch_name', defaultValue: '', description: 'git branch name')
                string(name: 'folder_name', defaultValue: '', description: 'folder name')
                choice(name: 'build_option',
                         choices: ['','plan','apply', 'destroy'],
                                description: 'Apply will deploy a VPC, and Destroy will remove the VPC..')
                }
     stages{
         stage('Git Checkout'){
          steps{
                    sh """
                    cd "/home/jenkins/git/"
                    rm -rf *
                    echo "Git initilization started"
                    git init 
                    echo "Git initilization completed"
                    git clone --single-branch --branch main ${git_branch_name}
                    echo "Git pull completed"
                    """
            }
         }
          stage('Terraform init '){
          steps{
                    sh """
                        terraform -chdir="/home/jenkins/git/Terraform/vpc/${folder_name}/" init 
                        terraform -chdir="/home/jenkins/git/Terraform/vpc/${folder_name}/" ${build_option} --auto-approve 
                        """
            }
         }
     }
}
